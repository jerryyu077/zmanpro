# 员工工时管理系统 - 详细规划文档

## 📋 项目概述

### 项目定位
专为老板本人使用的极简移动端员工工时管理 Web App，主要在 iPhone Safari 上使用，实现快速、直观的工时记录与统计。

### 核心目标
- **极简易用**：一屏完成操作，无需滚动
- **快速录入**：支持单日/批量录入，直接输入或时间范围两种方式
- **即时统计**：多选日期自动汇总工时、工资、平均时薪
- **视觉优雅**：iOS 风格浅色新拟物 UI，柔光阴影，易点易读

---

## 🛠️ 技术栈

### 前端
- **HTML5 + CSS3 + Vanilla JavaScript**
- **无框架依赖**（纯原生实现，轻量快速）
- **CSS Variables** 统一配色
- **Flexbox + Grid** 布局
- **Touch Events** 优化移动端交互

### 后端
- **Cloudflare Workers**（Serverless API）
- **Cloudflare D1**（SQLite 数据库）
- **RESTful API** 设计

### 部署
- **Cloudflare Pages**（静态托管）
- **Wrangler CLI**（部署工具）

---

## 🎨 UI/UX 设计规范

### 配色方案
```css
/* 主色调 */
--bg-primary: #F5F5F7;           /* 浅灰背景 */
--card-bg: #FFFFFF;               /* 卡片白色 */
--text-primary: #1D1D1F;          /* 主文字黑 */
--text-secondary: #8E8E93;        /* 次要文字灰 */

/* 功能色 */
--blue-primary: #007AFF;          /* iOS 蓝 */
--blue-light: #E3F2FD;            /* 浅蓝背景 */
--green: #34C759;                 /* 绿色（统计） */
--orange: #FF9500;                /* 橙色（时薪） */
--red: #FF3B30;                   /* 红色（删除） */
--purple: #AF52DE;                /* 紫色（天数） */

/* 新拟物阴影 */
--shadow-outer: 8px 8px 16px rgba(163, 177, 198, 0.6),
                -8px -8px 16px rgba(255, 255, 255, 0.9);
--shadow-inner: inset 4px 4px 8px rgba(163, 177, 198, 0.5),
                inset -4px -4px 8px rgba(255, 255, 255, 0.9);
```

### 圆角规范
- 大卡片：`border-radius: 20px`
- 小按钮/输入框：`border-radius: 16px`
- 日历日期格子：`border-radius: 12px`

### 字体规范
- **系统字体**：`-apple-system, BlinkMacSystemFont, "PingFang SC", sans-serif`
- **标题**：`font-size: 24px; font-weight: 700`
- **副标题**：`font-size: 14px; font-weight: 400; color: var(--text-secondary)`
- **数据大字**：`font-size: 28px; font-weight: 600`

### 间距规范
- 页面边距：`padding: 20px`
- 卡片间距：`gap: 16px`
- 按钮最小高度：`min-height: 52px`（易点击）

---

## 📱 页面结构与功能详解

### 页面 1：员工列表页（`index.html`）

#### 布局结构
```
┌─────────────────────────────────┐
│  🔍 搜索员工姓名...              │
├─────────────────────────────────┤
│  ➕ 添加员工                     │
├─────────────────────────────────┤
│ ┌───────────────────────────┐   │
│ │ 的吧              时薪 ¥20 │   │
│ │ cn                        │   │
│ │ ┌────────┐ ┌────────┐    │   │
│ │ │本周 0h │ │本月 0h │    │   │
│ │ └────────┘ └────────┘    │   │
│ │ q               ✏️ 🗑️    │   │
│ └───────────────────────────┘   │
│ [更多员工卡片...]                │
└─────────────────────────────────┘
```

#### 功能清单
- [x] **搜索栏**：实时搜索员工姓名（防抖 300ms）
- [x] **添加员工按钮**：点击弹出新增表单
- [x] **员工卡片**：
  - 显示：姓名、工作地点、默认时薪、本周工时、本月工时、备注首字母
  - 点击卡片：进入员工日历页
  - 点击编辑图标：弹出编辑表单
  - 点击删除图标：二次确认后删除

#### 数据展示
- **本周工时**：自动计算本周一至今的总工时
- **本月工时**：自动计算本月1号至今的总工时

---

### 页面 2：员工日历页（`calendar.html`）

#### 布局结构
```
┌─────────────────────────────────┐
│ ⬅️     的吧           🔒  ☑️    │
│      默认时薪: ¥20/小时          │
├─────────────────────────────────┤
│      ◀  2025年11月  ▶           │
├─────────────────────────────────┤
│ 日 一 二 三 四 五 六             │
│ 26 27 28 29 30 31  1            │
│  2  3  4  5  6  7  8            │
│  9 10 [11] 12 13 14 15          │
│             8h                   │
│ 16 17 18 19 20 21 22            │
│ 23 24 25 26 27 28 29            │
│ 30  1  2  3  4  5  6            │
├─────────────────────────────────┤
│ 请选择日期                       │
└─────────────────────────────────┘
```

#### 功能清单
- [x] **返回按钮**：返回员工列表
- [x] **批量输入按钮（🔒）**：打开批量输入弹窗
- [x] **多选日期按钮（☑️）**：切换多选模式
- [x] **月份切换**：左右箭头切换月份
- [x] **日历渲染**：
  - 当月日期：黑色
  - 非当月日期：浅灰色
  - 已录入工时日期：显示工时数（如 `8h`）
  - 选中日期：蓝紫色渐变填充
- [x] **点击日期**：
  - 普通模式：展开单日录入表单
  - 多选模式：切换勾选状态，底部显示统计

---

### 页面 3：单日工时录入表单（日历页底部展开）

#### 两种输入模式

##### 模式 1：直接输入工时
```
┌─────────────────────────────────┐
│ 2025年11月11日      清除选择     │
├─────────────────────────────────┤
│ 输入方式                         │
│ ⦿ 直接输入工时  ⚪ 时间范围      │
├─────────────────────────────────┤
│ 工作时长（小时）                 │
│ [     8.5      ]                │
├─────────────────────────────────┤
│ 当天时薪（元/小时）              │
│ [      20      ]                │
├─────────────────────────────────┤
│ 备注                             │
│ [工作内容、项目名称等...]        │
├─────────────────────────────────┤
│         保存                     │
└─────────────────────────────────┘
```

##### 模式 2：时间范围
```
┌─────────────────────────────────┐
│ 2025年11月12日      清除选择     │
├─────────────────────────────────┤
│ 输入方式                         │
│ ⚪ 直接输入工时  ⦿ 时间范围      │
├─────────────────────────────────┤
│ 🕐 开始时间      🕐 结束时间     │
│   13:29           04:29          │
│     🕐              🕐           │
├─────────────────────────────────┤
│ 🧮 计算工时           15.0小时  │
├─────────────────────────────────┤
│ 当天时薪（元/小时）              │
│ [      20      ]                │
├─────────────────────────────────┤
│ 备注                             │
│ [工作内容、项目名称等...]        │
├─────────────────────────────────┤
│         保存                     │
└─────────────────────────────────┘
```

#### 功能清单
- [x] **清除选择**：清空当前日期选择，隐藏表单
- [x] **输入方式切换**：单选按钮切换两种模式
- [x] **直接输入模式**：数字输入框，支持小数（如 8.5）
- [x] **时间范围模式**：
  - 点击时钟图标：弹出 iOS 风格时间选择器
  - 自动计算工时（支持跨日计算）
  - 显示"计算工时"卡片
- [x] **时薪输入**：默认继承员工默认时薪，可修改
- [x] **备注输入**：多行文本框
- [x] **保存按钮**：
  - 新增数据：仅显示"保存"
  - 编辑数据：显示"删除" + "保存"

---

### 页面 4：多选日期统计（日历页底部展开）

#### 布局结构
```
┌─────────────────────────────────┐
│ 📄 汇总信息（2天）   清除选择    │
├─────────────────────────────────┤
│ ┌─────────┐  ┌─────────┐        │
│ │总工时   │  │日均工时 │        │
│ │ 23.0h   │  │ 11.5h   │        │
│ └─────────┘  └─────────┘        │
│ ┌─────────┐  ┌─────────┐        │
│ │有效天数 │  │总工资   │        │
│ │  2天    │  │ ¥460    │        │
│ └─────────┘  └─────────┘        │
└─────────────────────────────────┘
```

#### 功能清单
- [x] **自动统计**：勾选日期后实时计算
- [x] **总工时**：所选日期工时相加（蓝色）
- [x] **日均工时**：总工时 ÷ 有效天数（绿色）
- [x] **有效天数**：勾选的日期数量（紫色）
- [x] **总工资**：各日 `工时 × 时薪` 相加（橙色）
- [x] **清除选择**：取消所有勾选，退出多选模式

---

### 页面 5：批量输入工时弹窗（Modal）

#### 布局结构
```
┌─────────────────────────────────┐
│ 批量输入工时                  ✕ │
├─────────────────────────────────┤
│ 选择日期                         │
│ ┌───────────────────────────┐   │
│ │☐ 2025-11-01         周末  │   │
│ │☐ 2025-11-02         周末  │   │
│ │☐ 2025-11-03         周一  │   │
│ │☐ 2025-11-04         周二  │   │
│ └───────────────────────────┘   │
│ 已选择 0 个日期                  │
├─────────────────────────────────┤
│ 输入方式                         │
│ ⦿ 直接输入工时  ⚪ 时间范围      │
├─────────────────────────────────┤
│ 工作时长（小时）                 │
│ [     8.5      ]                │
├─────────────────────────────────┤
│ 时薪（元/小时）                  │
│ [      20      ]                │
├─────────────────────────────────┤
│ 备注                             │
│ [工作内容、项目名称等...]        │
├─────────────────────────────────┤
│         保存                     │
└─────────────────────────────────┘
```

#### 功能清单
- [x] **日期列表**：显示当月所有日期 + 星期标签
- [x] **多选复选框**：点击勾选/取消
- [x] **已选计数**：实时显示已选日期数
- [x] **统一录入**：为所选日期设置相同工时、时薪、备注
- [x] **关闭按钮**：点击 ✕ 或遮罩层关闭弹窗

---

### 页面 6：新增/编辑员工表单（Modal）

#### 布局结构
```
┌─────────────────────────────────┐
│ 添加员工 / 编辑员工            ✕ │
├─────────────────────────────────┤
│ 员工姓名                         │
│ [                  ]            │
├─────────────────────────────────┤
│ 工作地点/代码                    │
│ [                  ]            │
├─────────────────────────────────┤
│ 默认时薪（元/小时）              │
│ [                  ]            │
├─────────────────────────────────┤
│ 备注                             │
│ [                  ]            │
├─────────────────────────────────┤
│         保存                     │
└─────────────────────────────────┘
```

#### 功能清单
- [x] **新增模式**：标题"添加员工"，所有字段为空
- [x] **编辑模式**：标题"编辑员工"，字段回填数据
- [x] **表单验证**：
  - 姓名必填
  - 时薪必填且为正数
- [x] **保存逻辑**：提交到后端 API

---

## 🗄️ 数据模型设计

### 1. 员工表（`employees`）
```sql
CREATE TABLE employees (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,                  -- 员工姓名
    location TEXT,                       -- 工作地点/代码
    default_hourly_rate REAL NOT NULL,   -- 默认时薪
    notes TEXT,                          -- 备注
    created_at TEXT DEFAULT (datetime('now', 'localtime')),
    updated_at TEXT DEFAULT (datetime('now', 'localtime'))
);
```

### 2. 工时记录表（`work_records`）
```sql
CREATE TABLE work_records (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    employee_id INTEGER NOT NULL,        -- 关联员工 ID
    date TEXT NOT NULL,                  -- 工作日期 YYYY-MM-DD
    hours REAL NOT NULL,                 -- 工作时长（小时）
    hourly_rate REAL NOT NULL,           -- 当天时薪
    start_time TEXT,                     -- 开始时间 HH:MM（可选）
    end_time TEXT,                       -- 结束时间 HH:MM（可选）
    notes TEXT,                          -- 备注
    created_at TEXT DEFAULT (datetime('now', 'localtime')),
    updated_at TEXT DEFAULT (datetime('now', 'localtime')),
    FOREIGN KEY (employee_id) REFERENCES employees(id) ON DELETE CASCADE,
    UNIQUE(employee_id, date)            -- 每人每天只能有一条记录
);
```

### 3. 索引优化
```sql
CREATE INDEX idx_work_records_employee_date ON work_records(employee_id, date);
CREATE INDEX idx_work_records_date ON work_records(date);
```

---

## 🔌 API 接口设计

### 基础 URL
```
/api/*
```

### 员工管理

#### 1. 获取所有员工
```http
GET /api/employees
```
**响应示例：**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "的吧",
      "location": "cn",
      "default_hourly_rate": 20,
      "notes": "q",
      "weekly_hours": 0,
      "monthly_hours": 0
    }
  ]
}
```

#### 2. 新增员工
```http
POST /api/employees
Content-Type: application/json

{
  "name": "张三",
  "location": "北京",
  "default_hourly_rate": 25,
  "notes": "前端开发"
}
```

#### 3. 更新员工
```http
PUT /api/employees/:id
Content-Type: application/json

{
  "name": "张三",
  "location": "上海",
  "default_hourly_rate": 30
}
```

#### 4. 删除员工
```http
DELETE /api/employees/:id
```

---

### 工时记录管理

#### 5. 获取员工某月工时记录
```http
GET /api/employees/:id/records?year=2025&month=11
```
**响应示例：**
```json
{
  "success": true,
  "data": {
    "employee": {
      "id": 1,
      "name": "的吧",
      "default_hourly_rate": 20
    },
    "records": [
      {
        "id": 1,
        "date": "2025-11-11",
        "hours": 8,
        "hourly_rate": 20,
        "start_time": null,
        "end_time": null,
        "notes": ""
      },
      {
        "id": 2,
        "date": "2025-11-12",
        "hours": 15,
        "hourly_rate": 20,
        "start_time": "13:29",
        "end_time": "04:29",
        "notes": ""
      }
    ]
  }
}
```

#### 6. 新增/更新单日工时
```http
POST /api/work-records
Content-Type: application/json

{
  "employee_id": 1,
  "date": "2025-11-11",
  "hours": 8.5,
  "hourly_rate": 20,
  "start_time": null,
  "end_time": null,
  "notes": "完成XX项目"
}
```
- **逻辑**：存在则更新，不存在则新增（UPSERT）

#### 7. 批量新增工时
```http
POST /api/work-records/batch
Content-Type: application/json

{
  "employee_id": 1,
  "dates": ["2025-11-01", "2025-11-02", "2025-11-03"],
  "hours": 8.5,
  "hourly_rate": 20,
  "notes": "统一备注"
}
```

#### 8. 删除工时记录
```http
DELETE /api/work-records/:id
```

#### 9. 多日期统计
```http
POST /api/work-records/statistics
Content-Type: application/json

{
  "employee_id": 1,
  "dates": ["2025-11-11", "2025-11-12"]
}
```
**响应示例：**
```json
{
  "success": true,
  "data": {
    "total_hours": 23.0,
    "average_hours": 11.5,
    "total_days": 2,
    "total_salary": 460
  }
}
```

---

## 📂 项目文件结构

```
zmansys3/
├── public/                    # 静态文件（Cloudflare Pages）
│   ├── index.html            # 员工列表页
│   ├── calendar.html         # 员工日历页
│   ├── css/
│   │   └── style.css         # 统一样式文件
│   ├── js/
│   │   ├── app.js            # 员工列表页逻辑
│   │   ├── calendar.js       # 日历页逻辑
│   │   ├── api.js            # API 请求封装
│   │   └── utils.js          # 工具函数
│   └── assets/
│       └── icons/            # 图标资源
├── worker/                    # Cloudflare Workers
│   ├── index.js              # API 路由与业务逻辑
│   └── database.js           # D1 数据库操作
├── wrangler.toml             # Cloudflare 配置
├── schema.sql                # 数据库初始化脚本
├── PROJECT_PLAN.md           # 本规划文档
└── README.md                 # 项目说明
```

---

## 🚀 开发步骤

### 阶段 1：基础架构搭建
- [ ] 创建 `wrangler.toml` 配置文件
- [ ] 初始化 D1 数据库，执行 `schema.sql`
- [ ] 搭建 Workers API 基础路由
- [ ] 测试 API 连通性

### 阶段 2：员工列表页开发
- [ ] 编写 `index.html` 结构
- [ ] 实现新拟物风格 CSS
- [ ] 开发员工卡片渲染逻辑
- [ ] 实现搜索功能
- [ ] 实现新增/编辑/删除员工
- [ ] 计算本周/本月工时

### 阶段 3：日历页开发
- [ ] 编写 `calendar.html` 结构
- [ ] 实现日历网格渲染
- [ ] 月份切换功能
- [ ] 显示已录入工时日期
- [ ] 单日工时录入表单（直接输入模式）
- [ ] 时间范围输入模式 + 自动计算
- [ ] 编辑/删除已有工时

### 阶段 4：高级功能开发
- [ ] 多选日期模式
- [ ] 多日期统计卡片
- [ ] 批量输入工时弹窗
- [ ] 时间选择器组件（iOS 风格）

### 阶段 5：优化与部署
- [ ] 移动端适配（Touch、缩放禁用）
- [ ] 性能优化（防抖、懒加载）
- [ ] 错误处理与提示
- [ ] 部署到 Cloudflare Pages
- [ ] 测试多设备访问一致性

---

## 🔒 安全与认证

### 简易认证方案（单账号）
```javascript
// 在 Workers 中硬编码密码（或使用环境变量）
const ADMIN_PASSWORD = env.ADMIN_PASSWORD; // "your-password"

// 简单 Token 认证
if (request.headers.get('Authorization') !== `Bearer ${ADMIN_PASSWORD}`) {
  return new Response('Unauthorized', { status: 401 });
}
```

### 前端存储
- **Token 存储**：`localStorage.setItem('auth_token', password)`
- **每次请求携带**：`Authorization: Bearer ${token}`

---

## 📱 移动端适配

### Viewport 设置
```html
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="light-content">
```

### Touch 优化
```css
* {
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}

button, a {
  cursor: pointer;
  user-select: none;
}
```

---

## 🎯 交互细节清单

### 全局
- [x] 所有表单默认继承上下文数据（如时薪）
- [x] 点击遮罩层关闭弹窗
- [x] 所有删除操作需二次确认
- [x] 加载中显示 Loading 动画

### 日历页
- [x] 已有工时的日期显示工时数
- [x] 点击非当月日期自动切换月份
- [x] 多选模式下日期显示蓝色方框勾选状态

### 表单
- [x] 输入框聚焦时显示蓝色边框
- [x] 数字输入框限制为数字+小数点
- [x] 时间选择器滚轮选择（iOS 风格）

### 统计卡片
- [x] 数据变化时有淡入动画
- [x] 不同数据类型用不同颜色区分

---

## 🧪 测试用例

### 功能测试
- [ ] 新增员工 → 列表显示 → 点击进入日历
- [ ] 单日录入工时（两种模式）→ 日历显示工时
- [ ] 编辑工时 → 数据更新 → 删除工时
- [ ] 批量录入 → 多日期同时创建记录
- [ ] 多选统计 → 数据计算正确
- [ ] 搜索员工 → 实时过滤

### 边界测试
- [ ] 跨日工时计算（如 23:00 → 02:00）
- [ ] 删除员工后关联工时记录级联删除
- [ ] 日期范围跨月份
- [ ] 重复提交防抖

---

## 📊 性能指标

### 目标
- **首屏加载**：< 1s
- **API 响应**：< 200ms
- **日历渲染**：< 100ms
- **动画帧率**：60fps

---

## 🔄 后续扩展（可选）

- [ ] 导出 Excel 报表
- [ ] 数据可视化图表（月度工时趋势）
- [ ] 多账号支持（不同老板）
- [ ] 微信通知提醒
- [ ] PWA 离线支持

---

## 📝 备注

1. **所有截图已严格记录**，UI 实现需 100% 还原
2. **不增加额外功能**，保持极简原则
3. **优先移动端体验**，桌面端为次要
4. **代码需注释清晰**，便于后续维护

---

**规划完成时间**：2025-11-21  
**预计开发周期**：3-5 天  
**开发优先级**：P0（核心功能） → P1（高级功能） → P2（优化细节）

